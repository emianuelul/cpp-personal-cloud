import { FileCard } from "file_card.slint";
import { ScrollView } from "std-widgets.slint";
import { MyButton } from "my_button.slint";
import { FolderCard } from "folder_card.slint";

export struct File {
    name: string,
    path: string,
    size: string,
}


export struct DirEntry {
    name: string,
    path: string,
    file-count: int,
}


export component FileExplorer inherits Rectangle {
    in property <string> current-path: "/";
    in property <[DirEntry]> subdirs: [
        { name: "Documents", path: "/Documents", file-count: 45 },
        { name: "Pictures", path: "/Pictures", file-count: 238 },
        { name: "Downloads", path: "/Downloads", file-count: 67 },
        { name: "Music", path: "/Music", file-count: 152 },
    ];

    in property <[File]> files: [
        { name: "vacation_photo.jpg", path: "/home/user/pictures", size: "2.4 MB" },
        { name: "report_2024.pdf", path: "/home/user/documents", size: "1.8 MB" },
        { name: "presentation.pptx", path: "/home/user/work", size: "5.2 MB" },
        { name: "music_playlist.mp3", path: "/home/user/music", size: "3.7 MB" },
        { name: "budget_sheet.xlsx", path: "/home/user/finance", size: "892 KB" },
    ];

    callback update-metadata(string, string, string);
    callback navigate-to-dir(string);
    callback navigate-back();

    property <int> gap: 12;

    border-radius: 16px;
    background: white;

    VerticalLayout {

        HorizontalLayout {
            spacing: 32px;
            alignment: start;

            Rectangle {
                width: 80px;
                height: 32px;
                border-radius: 6px;
                background: current-path == "/" ? rgba(78, 141, 242, 0.2) : back-touch.has-hover ? rgba(78, 141, 242, 1) : rgba(78, 141, 242, 0.6);

                back-touch := TouchArea {
                    clicked => {
                        if (current-path != "/") {
                            navigate-back();
                        }
                    }

                    mouse-cursor: current-path == "/" ? default : pointer;
                }

                Text {
                    text: "â† Back";
                    horizontal-alignment: center;
                    vertical-alignment: center;
                    font-size: 16px;
                    font-weight: 600;
                    color: current-path == "/" ? rgba(37, 42, 48, 0.2) : back-touch.has-hover ? rgba(37, 42, 48, 1) : rgba(37, 42, 48, 0.6);
                    animate color { duration: 100ms; }
                }

                animate background { duration: 100ms; }
            }

            Text {
                text: current-path;
                font-size: 24px;
                color: rgba(37, 42, 48, 0.6);
                vertical-alignment: center;
            }
        }

        Rectangle {
            height: 3px;
            background: #d0d0d0;
        }

        padding: 32px;

        spacing: gap * 1px;

        ScrollView {
            VerticalLayout {
                padding: 16px;
                spacing: gap * 1px;

                for directory[i] in subdirs: VerticalLayout {
                    spacing: gap * 1px;

                    FolderCard {
                        name: directory.name;
                        file-count: directory.file-count;
                        path: directory.path;

                        navigate-to-dir(path) => {
                            navigate-to-dir(path);
                        }
                    }

                    if (i < subdirs.length - 1 || files.length > 0): Rectangle {
                        height: 1px;
                        background: #e8e8e8;
                        width: 95%;
                    }
                }

                for file[i] in files: VerticalLayout {
                    FileCard {
                        name: file.name;
                        path: file.path;
                        size: file.size;

                        clicked => {
                            update-metadata(self.name, self.path, self.size);
                        }
                    }

                    spacing: gap * 1px;

                    if (i < root.files.length - 1): Rectangle {
                        height: 1px;
                        background: #d0d0d0;
                        width: 95%;
                    }
                }

                if (files.length == 0 && subdirs.length == 0): Text {
                    text: "No files :^)";
                    font-size: 24px;
                    font-weight: 600;
                    color: rgba(0,0,0,0.5);
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
        }
    }
}
